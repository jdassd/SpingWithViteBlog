# 博客系统功能设计文档 V2.0（后端 Spring Boot / JDK21 / MySQL / MyBatis，前端 Vite + Element）

> 本文档基于 V1.0 版本进行功能扩展，新增互动功能、内容增强、数据分析、SEO优化等模块。
> 
> **定位说明**：本系统为管理员个人博客，仅管理员可发表文章，普通用户为访客/读者角色。

---

## 1. 版本概述

### 1.1 V2.0 新增功能概览

| 模块 | 新增功能 |
|------|----------|
| 互动增强 | 文章点赞、用户收藏夹 |
| 内容增强 | 定时发布、文章系列/专栏、版本历史、草稿自动保存 |
| 数据分析 | 访问统计、热门排行、用户行为分析、数据导出 |
| SEO优化 | Sitemap自动生成、Open Graph、结构化数据、友链管理 |

### 1.2 设计原则

* 向后兼容：V2.0 所有新功能均为可选启用，不影响 V1.0 核心功能
* 渐进增强：新功能模块化设计，可按需部署
* 性能优先：数据分析等高负载功能支持异步处理与缓存

---

## 2. 互动增强模块

### 2.1 文章点赞

#### 功能定义

* 登录用户可对文章点赞
* 点赞计数作为文章热度指标之一

#### 行为规则

* 同一用户对同一文章仅可点赞一次
* 支持取消点赞
* 点赞需登录，游客点击提示登录
* 点赞数参与热门排行算法计算

#### 数据记录

* 记录点赞用户ID、文章ID、点赞时间
* 文章表维护点赞总数（缓存或定期统计）

### 2.2 用户收藏夹

#### 功能定义

* 登录用户可收藏文章到个人收藏夹
* 支持创建多个收藏夹分类管理
* 收藏夹可设为公开或私密

#### 收藏夹属性

* 名称（必填）
* 描述（可选）
* 可见性：公开 / 私密
* 创建时间、更新时间

#### 行为规则

* 默认收藏夹：系统自动创建"默认收藏夹"
* 收藏时可选择目标收藏夹
* 同一文章可存在于多个收藏夹
* 删除收藏夹时可选择：同时取消收藏 / 移动到默认收藏夹
* 收藏数参与热门排行算法计算

#### 公开收藏夹展示

* 公开收藏夹可在用户主页展示
* 其他用户可查看公开收藏夹内容

---

## 3. 内容增强模块

### 3.1 定时发布

#### 功能定义

* 文章/页面支持设置定时发布时间
* 到达发布时间后自动变更状态为"已发布"

#### 行为规则

* 定时发布时间必须晚于当前时间（校验）
* 定时中的文章状态为 `SCHEDULED`
* 定时发布前可随时修改或取消
* 发布失败（如数据异常）时记录日志并通知管理员

#### 技术实现建议

* 使用定时任务扫描（如每分钟）
* 或使用延迟队列（RabbitMQ / Redis Delayed Queue）

### 3.2 文章系列/专栏

#### 功能定义

* **系列（Series）**：将多篇文章组织为有序系列
* 系列具有：标题、描述、封面、可见性

#### 行为规则

* 一篇文章可属于 0..1 个系列
* 系列内文章按手动排序或发布时间排序
* 系列可设置为"连载中"或"已完结"
* 系列支持独立可见性（与文章可见性取交集）

#### 展示规则

* 文章详情页显示"所属系列"及上一篇/下一篇
* 系列详情页展示系列目录

### 3.3 文章版本历史

#### 功能定义

* 每次发布（非草稿保存）自动创建版本快照
* 支持查看历史版本、对比差异、回滚

#### 存储策略

* 仅存储内容变更部分（差异存储）或全量快照（简单实现）
* 版本保留数量可配置（默认保留最近20个版本）

#### 操作权限

* 管理员：可查看、对比、回滚所有文章版本

### 3.4 草稿自动保存

#### 功能定义

* 编辑器内容每隔 N 秒自动保存草稿
* 支持恢复未保存的草稿（浏览器崩溃恢复）

#### 行为规则

* 自动保存间隔可配置（默认30秒）
* 自动保存不触发版本历史（仅手动保存/发布触发）
* 草稿存储位置：LocalStorage + 后端草稿表

---

## 4. 数据分析模块

### 4.1 访问统计

#### 统计维度

* **文章维度**：PV（浏览量）、UV（独立访客）、平均阅读时长
* **站点维度**：总访问量、实时在线人数、访客来源
* **时间维度**：日/周/月趋势图

#### 数据采集

* 前端埋点：页面停留时间、滚动深度
* 后端记录：接口访问日志
* 去重策略：同一IP/用户 N分钟内多次访问计为1次

#### 隐私合规

* 可配置是否启用详细统计
* 支持匿名化处理（不记录完整IP）

### 4.2 热门排行

#### 排行类型

* 热门文章（日/周/月/总）
* 热门标签

#### 热度算法（可配置权重）

```
热度分 = 阅读量 × W1 + 点赞数 × W2 + 评论数 × W3 + 收藏数 × W4 + 时间衰减因子
```

* 默认权重：W1=1, W2=3, W3=5, W4=2
* 时间衰减：发布越早衰减越大

### 4.3 数据看板（仪表盘增强）

#### 新增指标卡片

* 今日/本周/本月访问量
* 新增用户数（注册读者）
* 新增评论数
* 点赞/收藏统计

#### 可视化图表

* 访问趋势折线图
* 文章分类分布饼图
* 用户活跃时段热力图

### 4.4 数据导出

#### 导出类型

* 文章列表（CSV/Excel）
* 评论列表
* 访问日志

#### 权限控制

* 仅管理员可导出数据
* 导出操作记入审计日志

---

## 5. SEO优化模块

### 5.1 Sitemap自动生成

#### 功能定义

* 自动生成 `sitemap.xml`
* 仅包含 PUBLIC + PUBLISHED 的内容

#### 更新策略

* 内容变更后异步更新
* 支持手动强制刷新
* 可配置更新频率提示（daily/weekly/monthly）

### 5.2 Open Graph & Twitter Card

#### 自动生成Meta标签

* `og:title` / `og:description` / `og:image`
* `twitter:card` / `twitter:title` / `twitter:description`

#### 配置规则

* 文章：使用标题、摘要、封面图
* 首页：使用站点名称、描述、Logo
* 支持文章级别自定义覆盖

### 5.3 结构化数据（Schema.org）

#### 支持类型

* Article（博客文章）
* Person（作者/管理员）
* Organization（站点）
* BreadcrumbList（面包屑）

#### 输出格式

* JSON-LD 格式嵌入页面

### 5.4 友情链接管理

#### 功能定义

* 管理员可添加/编辑/删除友链
* 字段：站点名称、URL、描述、Logo、分类、排序

#### 展示规则

* 前台友链页面展示
* 支持分类展示
* 可配置是否显示在首页/侧边栏

#### 链接检测

* 定时检测友链可用性
* 失效链接通知管理员

---

## 6. 配置项清单（V2.0新增）

### 互动增强

* 是否启用点赞功能（默认开）
* 是否启用收藏功能（默认开）
* 是否允许公开收藏夹（默认开）

### 内容增强

* 是否启用定时发布（默认开）
* 是否启用文章系列（默认开）
* 版本历史保留数量（默认20）
* 草稿自动保存间隔（默认30秒）

### 数据分析

* 是否启用访问统计（默认开）
* 是否匿名化IP（默认开）
* 热度算法权重配置
* 数据保留周期（默认365天）

### SEO

* 是否启用Sitemap（默认开）
* 是否启用Open Graph（默认开）
* Sitemap更新频率

---

## 7. 验收标准（V2.0新增功能）

### 互动增强

1. 登录用户可点赞/取消点赞文章
2. 点赞数正确显示与更新
3. 收藏夹创建、编辑、删除功能正常
4. 文章收藏到指定收藏夹功能正常
5. 公开收藏夹可被其他用户查看

### 内容增强

1. 定时发布到时间自动发布
2. 文章系列创建与文章关联正常
3. 系列内文章排序与导航正确
4. 版本历史可查看、对比、回滚
5. 草稿自动保存与恢复正常

### 数据分析

1. 文章阅读量正确统计（去重）
2. 热门排行数据准确
3. 仪表盘图表正确渲染
4. 数据导出文件格式正确

### SEO

1. sitemap.xml可访问且内容正确
2. 页面Meta标签正确生成
3. 结构化数据验证通过
4. 友链管理与展示正常
5. 友链可用性检测功能正常

---

## 8. 附录：V1.0与V2.0功能对照

| 功能模块 | V1.0 | V2.0新增 |
|----------|------|----------|
| 用户认证 | 注册/登录/JWT | - |
| 博文管理 | MD/富文本/可见性 | 定时发布/系列/版本历史/自动保存 |
| 互动 | 评论/回复 | 点赞/收藏 |
| 数据 | - | 访问统计/热门排行/数据导出 |
| SEO | - | Sitemap/OG/结构化数据/友链 |
| 安全 | RBAC/资源可见性 | - |
| 系统 | 主题/自定义CSS/JS | - |
