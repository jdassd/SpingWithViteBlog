# 原型说明（按页面/交互/校验/状态提示）

> 说明：以下以 **Vite + Element Plus** 的典型后台布局（左侧菜单 + 顶部栏 + 内容区）描述。前台（用户侧）与后台（管理侧）分开。所有列表页默认：分页、排序（如适用）、关键字搜索、状态筛选、空态提示、加载态骨架屏、错误提示。

---

## 1. 全局原型约定

### 1.1 顶部栏（前台/后台共用）

* 左侧：站点 Logo（点击回首页）
* 中间：面包屑（后台）/导航菜单（前台）
* 右侧：

  * 未登录：`登录` `注册`
  * 已登录：头像下拉：`个人资料` `我的文章(若允许)` `我的评论` `退出登录`
  * 若为 Admin：额外入口 `后台管理`

**全局提示**

* 请求中：按钮显示 loading，表格显示 loading，骨架屏
* 成功：Element Message 成功提示（可配置是否自动关闭）
* 失败：错误 Message，必要时弹窗展示后端错误原因（开发环境更详细）

### 1.2 权限与路由守卫

* 前端路由元信息：

  * `requiresAuth`
  * `roles: ['ADMIN']`
* 进入受限页面：

  * 未登录：跳转登录页，保留 redirect
  * 无权限：展示 403 页面（含返回首页按钮）
* 列表与详情均做二次校验：

  * 即使路由进来了，接口返回 403 也要正确处理

### 1.3 删除/危险操作交互

* 所有删除类操作：二次确认弹窗（Element Popconfirm 或 Dialog）
* 主题切换、自定义 JS 启用、图床配置保存：提示“影响全站”，需要明确确认
* 所有保存：支持“取消”回退（不保存）

---

## 2. 前台（用户侧）原型

### 2.1 首页（3 种模式）

后台可配置首页模式：博客流 / 导航门户 / 主题自定义首页。前台根据配置加载对应组件。

#### A. 博客流首页

* 区块：

  * 顶部：站点简介（可选）、搜索框（站内搜索）
  * Tab：`最新` `热门(可选)` `分类` `标签`
  * 文章列表卡片：标题、摘要、作者、发布时间、标签、阅读量(可选)、评论数(可选)
* 交互：

  * 点击标题进入文章详情
  * 分类/标签可点，进入列表页
  * 翻页分页
* 规则：

  * 列表只展示当前用户可见文章
  * 未登录访问 LOGIN_ONLY：列表不出现该文章（不是显示“锁”）

#### B. 导航门户首页

* 区块：

  * 搜索框：右侧搜索引擎下拉（Google/Bing/百度/站内搜索等）
  * 导航分组：每组标题 + 多个站点卡片
  * “自定义页面入口”（指向站内页面）
* 交互：

  * 选择搜索引擎后回车/按钮跳转
  * 点击卡片：外链打开（同窗口/新窗口可配置）
* 校验提示：

  * 搜索关键字为空：提示“请输入关键字”
  * 外链不合法：不渲染或点击提示“链接不可用”

#### C. 主题自定义首页

* 由主题模板渲染
* 若模板缺失：展示降级页（提示主题缺少首页模板，Admin 可见详细错误）

---

### 2.2 文章列表页（通用）

* 筛选栏：

  * 关键字（标题/摘要）
  * 分类选择（下拉）
  * 标签选择（多选）
  * 时间范围（可选）
* 列表：

  * 卡片/表格两种样式由主题决定
* 交互：

  * 进入详情
  * 分享（复制链接）
* 状态：

  * 无结果：空态“没有符合条件的文章”
  * 加载失败：提示“加载失败，重试”

---

### 2.3 文章详情页（核心：按类型渲染）

#### 页面结构

* 标题、作者、发布时间、分类/标签、阅读数（可选）
* 正文区域：

  * 若 `contentType=MARKDOWN`：Markdown 渲染组件（支持目录/代码高亮可选）
  * 若 `contentType=RICH_TEXT`：HTML 渲染容器（必须配合安全策略）
* 文章末尾：

  * 上一篇/下一篇（可选）
  * 评论区

#### 权限提示

* 403：

  * 未登录：展示“此内容需要登录”，按钮：登录
  * 无权限：展示“无权访问”，按钮：返回首页
* 404：展示“文章不存在或已删除”

---

### 2.4 评论区原型（文章详情页内）

#### 展示

* 顶部：评论总数、排序（最新/最早）
* 评论输入框：

  * 登录用户：可输入，支持 @回复（可选）
  * 游客：默认隐藏输入框，提示“登录后评论”
* 评论列表：

  * 每条评论：头像、昵称、时间、内容、`回复`按钮
  * 回复展开：默认显示最近 N 条，更多“展开更多回复”
* 分页：评论分页（或滚动加载）

#### 交互规则

* 发表：

  * 空内容：提示“请输入评论内容”
  * 过长：提示“超出长度限制”
  * 频控：提示“操作过于频繁，请稍后再试”
* 删除：

  * 本人评论：显示“删除”
  * Admin：所有评论显示“删除/屏蔽”
* 回复：

  * 点击回复后在该评论下方出现输入框（带“回复给 XXX”提示）
  * 回复框可取消

#### 审核模式 UI

* 若开启审核且当前用户非 Admin：

  * 发表评论成功提示：“已提交，等待审核”
  * 评论显示状态：本人可见“待审核”标记（其他人不可见）

---

### 2.5 相册前台

#### 相册列表页

* 卡片：封面、标题、数量、更新时间
* 筛选（可选）：标签、年份
* 权限：只展示可见相册

#### 相册详情页

* 瀑布流/网格展示缩略图
* 点击缩略图：大图预览弹窗（支持上一张/下一张、缩放）
* 可选展示 EXIF（若启用且不含敏感定位或已脱敏）

---

### 2.6 页面（自定义页面）前台

* 站内页面（Markdown/富文本）：

  * 与文章类似按类型渲染
* 外链页面：

  * 点击直接跳转（可配置新窗口）
  * 若链接不可用：展示提示页

---

## 3. 后台（Admin Console）原型

### 3.1 后台布局

* 左侧菜单（建议）：

  * 仪表盘
  * 文章管理
  * 评论管理
  * 页面与导航
  * 相册管理
  * 主题管理
  * 站点设置
  * 用户管理
  * 审计日志（建议）

---

## 4. 仪表盘（Admin）

### 页面内容

* 卡片指标：

  * 文章数（已发布/草稿）
  * 评论数（待审/已发布）
  * 用户数
  * 相册数/图片数
* 最近动态（时间线）：

  * 最近发布文章、最近评论、最近图床同步失败等

### 交互

* 点击卡片跳转对应列表并带筛选条件（如待审评论）

---

## 5. 文章管理（Admin）

### 5.1 文章列表页

#### 筛选栏

* 标题关键字
* 作者（可输入或下拉）
* 状态：草稿/已发布/已下线
* 类型：Markdown/富文本
* 可见性：PUBLIC/LOGIN_ONLY/WHITELIST/PRIVATE/ADMIN_ONLY
* 时间范围

#### 表格列（建议）

* 标题、作者、类型、状态、可见性、发布时间、更新时间、操作

#### 行操作

* `编辑`
* `发布/下线`
* `设置可见性`
* `预览`
* `删除`

#### 批量操作（可选）

* 批量发布、批量下线、批量删除（危险操作需确认）

---

### 5.2 新建/编辑文章页（重点）

#### 顶部区域

* 标题输入（必填）
* 类型选择：Markdown / 富文本（创建后是否允许切换：建议允许但需二次确认）
* 状态：草稿/发布（发布按钮）

#### 编辑区域

* 根据类型显示：

  * Markdown 编辑器（双栏预览可选）
  * 富文本编辑器

#### 侧栏（文章属性）

* 分类选择（可选）
* 标签选择（可选，支持新建标签可选）
* 可见性选择（核心）

  * PUBLIC
  * LOGIN_ONLY
  * WHITELIST（选择用户/组的弹窗）
  * PRIVATE
  * ADMIN_ONLY
* RSS 收录开关（可选）

  * 若非 PUBLIC 则默认不可开启或提示“仅私有 RSS 可收录”
* SEO（可选）：摘要、封面图、是否允许索引

#### 底部按钮

* `保存草稿`
* `发布/更新发布`
* `预览`
* `取消`

#### 校验提示

* 标题为空：红字提示
* 内容为空发布：提示确认或禁止
* WHITELIST 未选择用户：提示“请选择可见用户”
* 切换类型：提示“可能导致格式丢失，建议备份”

---

## 6. 评论管理（Admin）

### 6.1 评论列表页

#### 筛选

* 文章标题关键字
* 评论内容关键字
* 状态：待审/已发布/已屏蔽
* 用户（评论者）
* 时间范围

#### 表格列

* 评论内容摘要、所属文章、评论者、时间、状态、操作

#### 操作

* `通过`（仅待审）
* `驳回/删除`
* `屏蔽/取消屏蔽`
* `查看上下文`（打开抽屉：展示该评论线程与文章链接）

### 6.2 审核抽屉（建议）

* 左侧：评论线程
* 右侧：操作按钮（通过/驳回/屏蔽）
* 显示命中敏感词原因（若有）

---

## 7. 页面与导航（Admin）

### 7.1 页面管理列表

#### 筛选

* 标题关键字
* 类型：Markdown/富文本/外链
* 可见性
* 是否显示在导航栏

#### 表格列

* 标题、路径(slug)、类型、可见性、导航显示、排序、操作

#### 操作

* `编辑`
* `设置可见性`
* `启用/禁用（可选）`
* `删除`
* `调整排序`（上移/下移 或 拖拽排序）

### 7.2 新建/编辑页面

* 字段区：

  * 标题（必填）
  * slug/path（必填，唯一；实时校验重复）
  * 类型选择：

    * Markdown（显示 Markdown 编辑器）
    * 富文本（显示富文本编辑器）
    * 外链（显示 URL 输入）
  * 可见性选择（同文章）
  * 是否显示在导航栏（开关）
  * 排序权重（数字）
* 校验：

  * slug 非法字符提示（只允许字母数字-_/）
  * 外链必须 http/https
  * WHITELIST 必须选用户

### 7.3 导航首页配置

* 首页模式单选：

  * 博客流 / 导航门户 / 主题自定义
* 导航门户配置（当选择导航门户时显示）：

  * 搜索引擎列表管理（见下）
  * 导航分组管理（增删改查、排序）
  * 卡片管理（站点名、URL、图标、描述、分组、是否新窗口）

### 7.4 搜索引擎管理

* 列表：引擎名、查询 URL 模板、是否启用、默认引擎
* URL 模板示例：`https://www.google.com/search?q={q}`
* 操作：新增/编辑/禁用/设为默认
* 校验：

  * 必须包含 `{q}`
  * 必须是 http/https
* 前台行为：关键字必须 URL 编码后替换 `{q}`

---

## 8. 相册管理（Admin）

### 8.1 相册列表页

* 筛选：标题、可见性、创建者、时间范围
* 表格列：封面、标题、图片数、可见性、更新时间、操作
* 操作：

  * `进入管理`
  * `编辑信息`
  * `设置可见性`
  * `删除`

### 8.2 相册详情管理页（图片管理）

#### 顶部信息

* 相册标题、可见性、封面设置按钮

#### 上传区

* 上传按钮（支持拖拽）
* 上传设置（可选）：

  * 自动生成缩略图：开关
  * 自动去除 EXIF 定位：开关
  * 上传后自动同步图床：开关

#### 图片列表（网格）

* 每张图卡片：缩略图、状态标签（本地/已同步/失败）
* 卡片操作：

  * `设为封面`
  * `删除`
  * `重试同步`（失败时）
  * `复制外链`（已同步时）

#### 批量操作

* 批量同步、批量删除、批量重试（需确认）

#### 状态提示

* 同步中：进度条/旋转图标
* 失败：红色标签 + 失败原因（tooltip）
* 重试成功：提示并刷新状态

---

## 9. 主题管理（Admin）

### 9.1 主题列表页

* 卡片/表格：主题预览图、名称、版本、作者、是否启用
* 操作：

  * `启用`（对当前启用主题提示“将全站生效”）
  * `配置`（若主题支持配置项）
  * `导出`
  * `删除`（当前启用主题不可删或需先切换）
  * `导入主题`（上传 zip）

### 9.2 导入主题弹窗

* 上传 zip
* 校验结果展示：

  * 主题名、版本、兼容性检查结果
* 选项：

  * 导入后立即启用（开关）
* 错误提示：

  * 缺少 theme.json
  * 版本不兼容
  * 包结构不合法

### 9.3 主题配置页（如支持）

* 动态表单（根据主题声明生成）
* 实时预览（可选）：

  * 右侧 iframe 预览前台首页
* 按钮：

  * 保存
  * 恢复默认
  * 取消

---

## 10. 站点设置（Admin）

### 10.1 基础设置

* 站点名称、描述、Logo、favicon（上传）
* 首页模式选择（与导航配置联动入口）
* RSS 设置：

  * 是否启用公共 RSS
  * 是否输出全文/摘要
  * 私有 RSS 是否启用、token 过期策略（仅配置项展示）

### 10.2 安全与风控设置

* 游客评论：开关（默认关）
* 评论审核模式：免审/首评/全审
* 频控阈值：

  * 每分钟评论数、每分钟登录次数等
* 敏感词策略：命中后拒绝/待审

### 10.3 自定义 CSS / JS

* 自定义 CSS：多行编辑器 + `保存` + `预览(可选)`
* 自定义 JS：

  * 启用开关（默认关）
  * 多行编辑器
  * 保存时强提示：“JS 可能影响全站与安全”
* 版本与回滚（建议 UI）：

  * 历史版本列表（时间、操作者）
  * `回滚到此版本` 按钮（需确认）

### 10.4 图床配置（Git/Gitee）

* 平台选择：Git / Gitee（下拉）
* 仓库、分支、目录前缀、提交信息模板
* Token 输入（密码框显示）
* `测试连接`按钮：

  * 成功：提示“连接成功”
  * 失败：展示失败原因（鉴权失败/仓库不存在/无权限）
* 保存提示：“将影响后续上传同步”

---

## 11. 用户管理（Admin）

### 11.1 用户列表

* 筛选：用户名/邮箱、角色、状态（启用/禁用）
* 表格列：用户名、邮箱、角色、状态、注册时间、操作
* 操作：

  * `禁用/启用`
  * `设置角色`（User/Admin）
  * `重置密码`（生成临时密码或发送重置链接——取决于实现）
  * `查看详情`（抽屉展示：发文数、评论数等）

### 11.2 设置角色弹窗

* 单选：User / Admin
* 强提示：提升为 Admin 需要二次确认

---

## 12. 审计日志（建议实现）

### 列表

* 时间、操作者、动作类型、资源、结果（成功/失败）、备注（失败原因）
* 筛选：操作者、动作类型、时间范围、关键字
* 用于追踪：

  * 删除文章/评论
  * 切换主题
  * 修改自定义 JS/CSS
  * 修改图床配置
  * 用户角色变更

---

## 13. 普通用户“可选后台”（若允许用户发文/建相册）

> 若系统配置允许普通用户发文，则提供“我的内容”入口（不等同 Admin 后台）。

### 13.1 我的文章

* 列表：仅本人文章
* 新建/编辑：与 Admin 编辑器一致，但不可操作全局设置
* 可见性：

  * 允许设置 PUBLIC/LOGIN_ONLY/WHITELIST/PRIVATE
  * **不允许设置 ADMIN_ONLY**（该项保留给 Admin）
* 删除、下线：仅对本人文章生效

### 13.2 我的相册（若允许）

* 同相册管理但作用域为本人
* 图床同步：

  * 若需要控制成本与安全，建议仅 Admin 可启用“同步到 Git/Gitee”
  * 普通用户上传仅存本地/对象存储（或走管理员审核）

---

## 14. 页面状态与错误页（必须具备）

* 401 未登录：提示登录按钮
* 403 无权限：返回首页/返回上一页
* 404 不存在：返回首页
* 500 错误：提示重试、展示错误追踪 ID（方便定位）
* 空态：Element Empty（统一文案）
